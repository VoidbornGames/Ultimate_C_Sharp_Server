<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UltimateServer Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --bg-primary: #0a0e1a;
  --bg-secondary: #141927;
  --bg-tertiary: #1e2433;
  --bg-card: #1a1f2e;
  --bg-card-hover: #222938;
  --text-primary: #f1f5f9;
  --text-secondary: #94a3b8;
  --text-dim: #64748b;
  --accent: #6366f1;
  --accent-hover: #7c7ff3;
  --accent-light: #818cf8;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --info: #3b82f6;
  --border: #2a3244;
  --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.15);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Inter', sans-serif;
}

body {
  display: flex;
  height: 100vh;
  background: var(--bg-primary);
  color: var(--text-primary);
  overflow: hidden;
}

/* Login Page Styles */
.login-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  width: 100%;
  background: var(--bg-primary);
}

.login-card {
  width: 100%;
  max-width: 420px;
  padding: 40px;
  background: var(--bg-card);
  border-radius: 16px;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  position: relative;
  overflow: hidden;
}

.login-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent), var(--accent-light));
}

.login-header {
  text-align: center;
  margin-bottom: 30px;
}

.login-header h1 {
  font-size: 28px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.login-header h1 i {
  color: var(--accent);
  font-size: 32px;
}

.login-header p {
  color: var(--text-secondary);
  font-size: 16px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  color: var(--text-secondary);
  font-weight: 500;
  font-size: 14px;
}

.input-group {
  position: relative;
}

.input-group i {
  position: absolute;
  left: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-dim);
  font-size: 16px;
}

input[type="text"], input[type="password"] {
  width: 100%;
  padding: 14px 16px 14px 45px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: 15px;
  transition: all 0.3s ease;
}

input[type="text"]:focus, input[type="password"]:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.remember-forgot {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
}

.remember-me {
  display: flex;
  align-items: center;
  gap: 8px;
}

.remember-me input[type="checkbox"] {
  width: 18px;
  height: 18px;
  accent-color: var(--accent);
}

.remember-me label {
  color: var(--text-secondary);
  font-size: 14px;
  cursor: pointer;
}

.forgot-password {
  color: var(--accent);
  font-size: 14px;
  text-decoration: none;
  transition: color 0.3s ease;
}

.forgot-password:hover {
  color: var(--accent-hover);
}

.login-btn {
  width: 100%;
  padding: 14px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.login-btn:hover {
  background: var(--accent-hover);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
}

.login-btn:active {
  transform: translateY(0);
}

.login-btn:disabled {
  opacity: 0.7;
  cursor: not-allowed;
  transform: none;
}

.error-message {
  color: var(--danger);
  font-size: 14px;
  margin-top: 15px;
  padding: 10px;
  background: rgba(239, 68, 68, 0.1);
  border-radius: 8px;
  border-left: 3px solid var(--danger);
  display: none;
}

.success-message {
  color: var(--success);
  font-size: 14px;
  margin-top: 15px;
  padding: 10px;
  background: rgba(16, 185, 129, 0.1);
  border-radius: 8px;
  border-left: 3px solid var(--success);
  display: none;
}

.login-footer {
  text-align: center;
  margin-top: 30px;
  color: var(--text-dim);
  font-size: 13px;
}

.loading-spinner {
  display: none;
  width: 20px;
  height: 20px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: white;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.password-strength {
  height: 4px;
  border-radius: 2px;
  margin-top: 8px;
  background: var(--border);
  overflow: hidden;
}

.password-strength-bar {
  height: 100%;
  width: 0;
  transition: width 0.3s ease, background-color 0.3s ease;
}

.strength-weak { background: var(--danger); width: 33%; }
.strength-medium { background: var(--warning); width: 66%; }
.strength-strong { background: var(--success); width: 100%; }

/* Dashboard Styles */
.dashboard-container {
  display: none;
  width: 100%;
  height: 100vh;
}

.sidebar {
  width: 260px;
  background: var(--bg-secondary);
  display: flex;
  flex-direction: column;
  padding: 24px;
  border-right: 1px solid var(--border);
  position: relative;
  overflow: hidden;
}

.sidebar::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent-light), transparent);
  opacity: 0.5;
}

.sidebar h1 {
  font-size: 24px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 40px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.sidebar h1 i {
  color: var(--accent);
  font-size: 28px;
}

.nav-item {
  padding: 14px 18px;
  margin-bottom: 8px;
  border-radius: 10px;
  color: var(--text-secondary);
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 12px;
  transition: all 0.3s ease;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.nav-item::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  width: 3px;
  background: var(--accent);
  transform: scaleY(0);
  transition: transform 0.3s ease;
}

.nav-item i {
  font-size: 18px;
  width: 20px;
  text-align: center;
}

.nav-item:hover, .nav-item.active {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

.nav-item.active::before {
  transform: scaleY(1);
}

.nav-item.active i {
  color: var(--accent);
}

.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.topbar {
  background: var(--bg-secondary);
  padding: 16px 28px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: var(--shadow-sm);
}

.topbar h2 {
  font-weight: 600;
  font-size: 20px;
  color: var(--text-primary);
}

.topbar .time {
  color: var(--text-secondary);
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.user-menu {
  display: flex;
  align-items: center;
  gap: 15px;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  padding: 8px 12px;
  border-radius: 8px;
  transition: background 0.3s ease;
}

.user-info:hover {
  background: var(--bg-tertiary);
}

.user-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--accent);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 600;
}

.user-dropdown {
  position: relative;
}

.dropdown-menu {
  position: absolute;
  top: 100%;
  right: 0;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 8px 0;
  min-width: 180px;
  box-shadow: var(--shadow);
  z-index: 100;
  display: none;
}

.dropdown-menu.show {
  display: block;
}

.dropdown-item {
  padding: 10px 16px;
  color: var(--text-secondary);
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: background 0.3s ease;
}

.dropdown-item:hover {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

.dropdown-divider {
  height: 1px;
  background: var(--border);
  margin: 8px 0;
}

.logout-btn {
  color: var(--danger);
}

.content {
  flex: 1;
  padding: 28px;
  overflow-y: auto;
  background: var(--bg-primary);
}

/* Custom Scrollbar */
.content::-webkit-scrollbar {
  width: 8px;
}

.content::-webkit-scrollbar-track {
  background: var(--bg-secondary);
}

.content::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 4px;
}

.content::-webkit-scrollbar-thumb:hover {
  background: var(--accent);
}

/* Card Styles */
.card {
  background: var(--bg-card);
  border-radius: 12px;
  padding: 24px;
  box-shadow: var(--shadow-sm);
  margin-bottom: 24px;
  border: 1px solid var(--border);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}

.card h3 {
  color: var(--text-primary);
  margin-bottom: 16px;
  font-size: 18px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 10px;
}

.card h3 i {
  color: var(--accent);
  font-size: 16px;
}

/* Stats Grid */
.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  margin-bottom: 24px;
}

.stat-box {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}

.stat-box::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent), var(--accent-light));
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.stat-box:hover {
  transform: translateY(-5px);
  border-color: var(--accent);
  box-shadow: var(--shadow);
}

.stat-box:hover::before {
  transform: scaleX(1);
}

.stat-box strong {
  display: block;
  color: var(--text-secondary);
  font-size: 14px;
  margin-bottom: 10px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.stat-box p {
  font-size: 24px;
  font-weight: 700;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.stat-box i {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 20px;
  color: var(--accent);
  opacity: 0.3;
}

/* Charts */
.chart-row {
  display: flex;
  flex-wrap: nowrap;
  gap: 20px;
  margin: 20px 0;
}

.chart-container {
  flex: 1;
  background: var(--bg-card);
  padding: 20px;
  border-radius: 12px;
  height: 200px;
  min-width: 0;
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
}

.chart-title {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 10px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Videos */
.video-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.video-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(129, 140, 248, 0.05));
  opacity: 0;
  transition: opacity 0.3s ease;
}

.video-card:hover {
  border-color: var(--accent);
  transform: translateY(-5px);
  box-shadow: var(--shadow);
}

.video-card:hover::before {
  opacity: 1;
}

.video-card video {
  width: 100%;
  max-height: 150px;
  border-radius: 8px;
  background: var(--bg-primary);
}

.video-thumbnail {
  background-color: var(--bg-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-dim);
  font-size: 14px;
  height: 150px;
  background-size: cover;
  background-position: center;
  border-radius: 8px;
  margin-bottom: 12px;
  position: relative;
  overflow: hidden;
}

.video-thumbnail::after {
  content: '\f04b';
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
  position: absolute;
  color: rgba(255, 255, 255, 0.7);
  font-size: 32px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.video-card:hover .video-thumbnail::after {
  opacity: 1;
}

.video-card p {
  margin: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  color: var(--text-primary);
  font-weight: 500;
}

/* Form Elements */
input[type="text"] {
  width: 100%;
  padding: 12px 16px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: 15px;
  margin-bottom: 12px;
  transition: all 0.3s ease;
}

input[type="text"]:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

button {
  background: var(--accent);
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  font-size: 15px;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

button:hover {
  background: var(--accent-hover);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
}

button:active {
  transform: translateY(0);
}

button i {
  font-size: 14px;
}

#urlUploadStatus {
  margin-top: 10px;
  font-size: 14px;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 6px;
}

.progress-bar {
  height: 4px;
  width: 100%;
  background-color: var(--border);
  border-radius: 2px;
  margin-top: 10px;
  overflow: hidden;
}

.progress {
  height: 100%;
  background-color: var(--accent);
  width: 0;
  transition: width 0.3s ease;
}

/* Footer */
footer {
  text-align: center;
  padding: 16px;
  font-size: 13px;
  color: var(--text-dim);
  background: var(--bg-secondary);
  border-top: 1px solid var(--border);
}

/* Tab Content */
.tab-content {
  display: none;
  animation: fadeIn 0.3s ease;
}

.tab-content.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Loading Animation */
.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: var(--accent);
  animation: spin 1s ease-in-out infinite;
}

/* Logs */
.logs {
  max-height: 400px;
  overflow-y: auto;
  background: var(--bg-primary);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 16px;
  font-size: 14px;
  color: var(--text-secondary);
  font-family: 'Courier New', monospace;
  line-height: 1.6;
}

.logs div {
  margin-bottom: 6px;
  padding-bottom: 6px;
  border-bottom: 1px solid rgba(42, 50, 68, 0.3);
}

.logs div:last-child {
  border-bottom: none;
}

.log-info { color: var(--text-secondary); }
.log-warning { color: var(--warning); }
.log-error { color: var(--danger); }
.log-security { color: var(--info); }

/* Session Expired Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}

.modal-content {
  background: var(--bg-card);
  border-radius: 12px;
  padding: 30px;
  max-width: 400px;
  width: 90%;
  text-align: center;
  box-shadow: var(--shadow);
}

.modal-content h3 {
  margin-bottom: 15px;
  color: var(--text-primary);
}

.modal-content p {
  margin-bottom: 20px;
  color: var(--text-secondary);
}

.modal-content button {
  width: 100%;
}

/* Notification Toast */
.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 16px;
  box-shadow: var(--shadow);
  display: flex;
  align-items: center;
  gap: 12px;
  transform: translateX(400px);
  transition: transform 0.3s ease;
  z-index: 1000;
  max-width: 350px;
}

.toast.show {
  transform: translateX(0);
}

.toast-success {
  border-left: 4px solid var(--success);
}

.toast-error {
  border-left: 4px solid var(--danger);
}

.toast-warning {
  border-left: 4px solid var(--warning);
}

.toast-info {
  border-left: 4px solid var(--info);
}

.toast i {
  font-size: 20px;
}

.toast-success i {
  color: var(--success);
}

.toast-error i {
  color: var(--danger);
}

.toast-warning i {
  color: var(--warning);
}

.toast-info i {
  color: var(--info);
}

.toast-content {
  flex: 1;
}

.toast-title {
  font-weight: 600;
  margin-bottom: 4px;
  color: var(--text-primary);
}

.toast-message {
  font-size: 14px;
  color: var(--text-secondary);
}

.toast-close {
  background: none;
  border: none;
  color: var(--text-dim);
  cursor: pointer;
  padding: 0;
  font-size: 16px;
}

/* Responsive Design */
@media (max-width: 768px) {
  .sidebar {
    width: 70px;
    padding: 20px 10px;
  }
  
  .sidebar h1 {
    font-size: 0;
    margin-bottom: 30px;
  }
  
  .sidebar h1 i {
    font-size: 24px;
  }
  
  .nav-item span {
    display: none;
  }
  
  .nav-item {
    justify-content: center;
    padding: 14px;
  }
  
  .nav-item::before {
    display: none;
  }
  
  .stats {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }
  
  .chart-row {
    flex-direction: column;
  }
  
  .toast {
    right: 10px;
    left: 10px;
    max-width: none;
  }
}
    
/* Plugin Styles */
.plugin-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 16px;
  transition: all 0.3s ease;
}

.plugin-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow);
  border-color: var(--accent);
}

.plugin-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.plugin-title {
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 10px;
}

.plugin-title i {
  color: var(--accent);
}

.plugin-status {
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 500;
  text-transform: uppercase;
}

.plugin-status.active {
  background: rgba(16, 185, 129, 0.2);
  color: var(--success);
}

.plugin-status.inactive {
  background: rgba(239, 68, 68, 0.2);
  color: var(--danger);
}

.plugin-description {
  color: var(--text-secondary);
  margin-bottom: 15px;
  font-size: 14px;
}

.plugin-actions {
  display: flex;
  gap: 10px;
}

.plugin-btn {
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
}

.plugin-btn.primary {
  background: var(--accent);
  color: white;
}

.plugin-btn.primary:hover {
  background: var(--accent-hover);
}

.plugin-btn.secondary {
  background: var(--bg-tertiary);
  color: var(--text-secondary);
  border: 1px solid var(--border);
}

.plugin-btn.secondary:hover {
  background: var(--bg-card);
  color: var(--text-primary);
}

.plugin-content {
  margin-top: 15px;
  padding-top: 15px;
  border-top: 1px solid var(--border);
  display: none;
}

.plugin-content.show {
  display: block;
}

.plugin-form {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.plugin-form-group {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.plugin-form-group label {
  color: var(--text-secondary);
  font-size: 14px;
  font-weight: 500;
}

.plugin-form-group input,
.plugin-form-group select,
.plugin-form-group textarea {
  padding: 10px 14px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: 14px;
}

.plugin-form-group textarea {
  resize: vertical;
  min-height: 100px;
}

.plugin-result {
  margin-top: 15px;
  padding: 10px;
  border-radius: 8px;
  font-size: 14px;
  display: none;
}

.plugin-result.success {
  background: rgba(16, 185, 129, 0.1);
  border: 1px solid var(--success);
  color: var(--success);
}

.plugin-result.error {
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid var(--danger);
  color: var(--danger);
}

.plugin-result.show {
  display: block;
}

.plugin-result pre {
  white-space: pre-wrap;
  word-wrap: break-word;
  margin: 0;
  font-family: 'Courier New', monospace;
  font-size: 13px;
  max-height: 300px;
  overflow-y: auto;
}

.plugin-upload {
  margin-top: 20px;
  padding: 20px;
  border: 2px dashed var(--border);
  border-radius: 12px;
  text-align: center;
  transition: all 0.3s ease;
}

.plugin-upload:hover {
  border-color: var(--accent);
  background: rgba(99, 102, 241, 0.05);
}

.plugin-upload i {
  font-size: 48px;
  color: var(--text-dim);
  margin-bottom: 15px;
}

.plugin-upload h4 {
  color: var(--text-primary);
  margin-bottom: 10px;
}

.plugin-upload p {
  color: var(--text-secondary);
  margin-bottom: 15px;
  font-size: 14px;
}

.file-input-wrapper {
  position: relative;
  overflow: hidden;
  display: inline-block;
}

.file-input-wrapper input[type=file] {
  position: absolute;
  left: -9999px;
}

.file-input-label {
  display: inline-block;
  padding: 10px 20px;
  background: var(--accent);
  color: white;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.file-input-label:hover {
  background: var(--accent-hover);
}

.empty-plugins {
  text-align: center;
  padding: 40px;
  color: var(--text-dim);
}

.empty-plugins i {
  font-size: 48px;
  margin-bottom: 15px;
  color: var(--text-dim);
}

.empty-plugins h3 {
  color: var(--text-secondary);
  margin-bottom: 10px;
}

.empty-plugins p {
  margin-bottom: 20px;
}
</style>
</head>
<body>
<!-- Login Page -->
<div class="login-container" id="loginPage">
  <div class="login-card">
    <div class="login-header">
      <h1><i class="fas fa-server"></i> UltimateServer</h1>
      <p>Sign in to access your dashboard</p>
    </div>
    
    <form id="loginForm">
      <div class="form-group">
        <label for="username">Username</label>
        <div class="input-group">
          <i class="fas fa-user"></i>
          <input type="text" id="username" name="username" placeholder="Enter your username" required>
        </div>
      </div>
      
      <div class="form-group">
        <label for="password">Password</label>
        <div class="input-group">
          <i class="fas fa-lock"></i>
          <input type="password" id="password" name="password" placeholder="Enter your password" required>
        </div>
        <div class="password-strength">
          <div class="password-strength-bar" id="passwordStrength"></div>
        </div>
      </div>
      
      <div class="remember-forgot">
        <div class="remember-me">
          <input type="checkbox" id="remember" name="remember">
          <label for="remember">Remember me</label>
        </div>
        <a href="#" class="forgot-password">Forgot password?</a>
      </div>
      
      <button type="submit" class="login-btn" id="loginBtn">
        <i class="fas fa-sign-in-alt"></i>
        <span id="loginBtnText">Sign In</span>
        <div class="loading-spinner" id="loginSpinner"></div>
      </button>
      
      <div class="error-message" id="errorMessage"></div>
      <div class="success-message" id="successMessage"></div>
    </form>
    
    <div class="login-footer">
      &copy; 2025 UltimateServer · VoidbornGames
    </div>
  </div>
</div>

<!-- Dashboard -->
<div class="dashboard-container" id="dashboardPage">
  <aside class="sidebar">
    <h1><i class="fas fa-server"></i> <span>UltimateServer</span></h1>
    <div class="nav-item active" data-tab="statsTab">
      <i class="fas fa-chart-line"></i> <span>Stats</span>
    </div>
    <div class="nav-item" data-tab="logsTab">
      <i class="fas fa-file-alt"></i> <span>Logs</span>
    </div>
    <div class="nav-item" data-tab="videosTab">
      <i class="fas fa-video"></i> <span>Videos</span>
    </div>
    <div class="nav-item" data-tab="pluginsTab">
      <i class="fas fa-plug"></i> <span>Plugins</span>
    </div>
  </aside>

  <div class="main">
    <div class="topbar">
      <h2>Dashboard</h2>
      <div class="time">
        <i class="far fa-clock"></i>
        <span id="currentTime"></span>
      </div>
      <div class="user-menu">
        <div class="user-dropdown">
          <div class="user-info" id="userInfo">
            <div class="user-avatar" id="userAvatar">A</div>
            <span id="userName">Admin</span>
            <i class="fas fa-chevron-down"></i>
          </div>
          <div class="dropdown-menu" id="userDropdown">
            <a href="#" class="dropdown-item">
              <i class="fas fa-user-circle"></i> Profile
            </a>
            <a href="#" class="dropdown-item">
              <i class="fas fa-cog"></i> Settings
            </a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item logout-btn" id="logoutBtn">
              <i class="fas fa-sign-out-alt"></i> Logout
            </a>
          </div>
        </div>
      </div>
    </div>
    <div class="content">
      <!-- Stats -->
      <div class="tab-content active" id="statsTab">
        <div class="stats">
          <div class="stat-box">
            <i class="fas fa-clock"></i>
            <strong>Uptime</strong>
            <p id="uptime">Loading...</p>
          </div>
          <div class="stat-box">
            <i class="fas fa-microchip"></i>
            <strong>CPU Usage</strong>
            <p id="cpuUsage">Loading...</p>
          </div>
          <div class="stat-box">
            <i class="fas fa-memory"></i>
            <strong>Memory Usage</strong>
            <p id="memoryUsage">Loading...</p>
          </div>
          <div class="stat-box">
            <i class="fas fa-hdd"></i>
            <strong>Disk Usage</strong>
            <p id="diskUsage">Loading...</p>
          </div>
          <div class="stat-box">
            <i class="fas fa-download"></i>
            <strong>Network Down</strong>
            <p id="networkUsageD">Loading...</p>
          </div>
          <div class="stat-box">
            <i class="fas fa-upload"></i>
            <strong>Network Up</strong>
            <p id="networkUsageU">Loading...</p>
          </div>
          <div class="stat-box">
            <i class="fas fa-users"></i>
            <strong>Users</strong>
            <p id="onlineUsers">Loading...</p>
          </div>
          <div class="stat-box">
            <i class="fas fa-link"></i>
            <strong>Max Connections</strong>
            <p id="maxConnections">Loading...</p>
          </div>
        </div>
        
        <!-- Graphs Side by Side -->
        <div class="card">
          <h3><i class="fas fa-chart-area"></i> System Performance</h3>
          <div class="chart-row">
            <div>
              <div class="chart-title">CPU Usage (%)</div>
              <div class="chart-container"><canvas id="cpuChart"></canvas></div>
            </div>
            <div>
              <div class="chart-title">Memory Usage (MB)</div>
              <div class="chart-container"><canvas id="memoryChart"></canvas></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Logs -->
      <div class="tab-content" id="logsTab">
        <div class="card">
          <h3><i class="fas fa-terminal"></i> Server Logs</h3>
          <div class="logs" id="serverLogs">Loading logs...</div>
        </div>
      </div>

      <!-- Videos -->
      <div class="tab-content" id="videosTab">
        <div class="card">
          <h3><i class="fas fa-play-circle"></i> Video Player</h3>
          <video id="videoPlayer" controls style="width:100%;max-height:400px;background:#000;border-radius:8px;display:none;">
            Your browser does not support the video tag.
          </video>
          <div id="loadingMsg" style="text-align:center; padding:20px; display:none;">
            <div class="loading"></div>
            <p style="margin-top: 10px; color: var(--text-secondary);">Loading video...</p>
          </div>
          <div id="videoError" style="text-align:center; padding:20px; display:none; color: var(--danger);">
            <i class="fas fa-exclamation-circle"></i>
            <p id="videoErrorText">Error loading video</p>
          </div>
        </div>

        <!-- Upload from URL -->
        <div class="card">
          <h3><i class="fas fa-cloud-download-alt"></i> Upload Video from URL</h3>
          <input type="text" id="videoUrlInput" placeholder="Enter video URL">
          <button onclick="uploadVideoFromUrl()">
            <i class="fas fa-download"></i> Download
          </button>
          <div class="progress-bar" id="uploadProgress" style="display: none;">
            <div class="progress" id="uploadProgressBar"></div>
          </div>
          <p id="urlUploadStatus"></p>
        </div>

        <!-- Video List -->
        <div class="card">
          <h3><i class="fas fa-film"></i> Video Library</h3>
          <div class="stats" id="videoList"></div>
        </div>
      </div>

      <!-- Plugins -->
      <div class="tab-content" id="pluginsTab">
        <div class="card">
          <h3><i class="fas fa-plug"></i> Plugin Management</h3>
          <div id="pluginsList">
            <div class="empty-plugins">
              <i class="fas fa-plug"></i>
              <h3>Loading plugins...</h3>
              <p>Please wait while we load the plugins</p>
            </div>
          </div>
        </div>
        
        <div class="card">
          <h3><i class="fas fa-upload"></i> Upload Plugin</h3>
          <div class="plugin-upload">
            <i class="fas fa-cloud-upload-alt"></i>
            <h4>Drop plugin file here or click to browse</h4>
            <p>Supported formats: .dll, .zip</p>
            <div class="file-input-wrapper">
              <input type="file" id="pluginFileInput" accept=".dll,.zip">
              <label for="pluginFileInput" class="file-input-label">
                <i class="fas fa-folder-open"></i> Browse Files
              </label>
            </div>
          </div>
          <div id="pluginUploadStatus"></div>
        </div>
      </div>
    </div>
    <footer>&copy; 2025 UltimateServer · VoidbornGames</footer>
  </div>
</div>

<!-- Session Expired Modal -->
<div class="modal" id="sessionModal">
  <div class="modal-content">
    <h3><i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i> Session Expired</h3>
    <p>Your session has expired. Please log in again to continue.</p>
    <button onclick="redirectToLogin()">
      <i class="fas fa-sign-in-alt"></i> Log In Again
    </button>
  </div>
</div>

<!-- Toast Notification -->
<div class="toast" id="toast">
  <i class="fas fa-info-circle"></i>
  <div class="toast-content">
    <div class="toast-title" id="toastTitle">Notification</div>
    <div class="toast-message" id="toastMessage">This is a notification message</div>
  </div>
  <button class="toast-close" id="toastClose">
    <i class="fas fa-times"></i>
  </button>
</div>

<script>
// =============================================================================
// BACKEND CONFIGURATION & API COMMUNICATION
// =============================================================================

// Get the base URL dynamically to work in any environment
const CONFIG = {
  get baseUrl() {
    return `${window.location.protocol}//${window.location.hostname}${window.location.port ? ':' + window.location.port : ''}`;
  }
};

// =============================================================================
// AUTHENTICATION STATE MANAGEMENT
// =============================================================================

class AuthManager {
  // Check if a user is currently logged in by checking for a token
  static isAuthenticated() {
    const token = localStorage.getItem('authToken') || sessionStorage.getItem('authToken');
    return !!token;
  }

  // Clear all authentication data from storage
  static clearAuth() {
    localStorage.removeItem('authToken');
    localStorage.removeItem('refreshToken');
    sessionStorage.removeItem('authToken');
    sessionStorage.removeItem('refreshToken');
    localStorage.removeItem('user');
    sessionStorage.removeItem('user');
  }

  // Store authentication data (tokens and user object)
  // 'remember' determines whether to use persistent localStorage or session-based storage
  static setAuth(token, refreshToken, user, remember = false) {
    const storage = remember ? localStorage : sessionStorage;
    storage.setItem('authToken', token);
    storage.setItem('refreshToken', refreshToken);
    storage.setItem('user', JSON.stringify(user));
  }

  // Retrieve authentication data from storage
  static getAuth() {
    const token = localStorage.getItem('authToken') || sessionStorage.getItem('authToken');
    const refreshToken = localStorage.getItem('refreshToken') || sessionStorage.getItem('refreshToken');
    const userStr = localStorage.getItem('user') || sessionStorage.getItem('user');
    
    let user = null;
    if (userStr) {
      try {
        user = JSON.parse(userStr);
      } catch (e) {
        console.error('Failed to parse user data from storage:', e);
        this.clearAuth(); // Clear corrupted data
      }
    }
    
    return { token, refreshToken, user };
  }

  // Automatically refresh the access token using the refresh token
  static async refreshAuthToken() {
    const auth = this.getAuth();
    if (!auth.refreshToken) {
      throw new Error('No refresh token available');
    }
    
    try {
      // Call the backend's refresh-token endpoint
      const response = await fetch(`${CONFIG.baseUrl}/api/refresh-token`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ refreshToken: auth.refreshToken })
      });
      
      if (!response.ok) {
        throw new Error('Token refresh failed');
      }
      
      const data = await response.json();
      if (data.success) {
        const remember = localStorage.getItem('authToken') !== null;
        this.setAuth(data.token, data.refreshToken || auth.refreshToken, auth.user, remember);
        return data.token;
      } else {
        throw new Error(data.message || 'Token refresh failed');
      }
    } catch (error) {
      console.error('Error refreshing token:', error);
      this.clearAuth(); // Clear invalid tokens
      throw error;
    }
  }
}

// =============================================================================
// API REQUEST HELPER WITH AUTOMATIC TOKEN REFRESH
// =============================================================================

// A wrapper around fetch() that handles authentication and automatic token refresh
async function apiRequest(url, options = {}) {
  const auth = AuthManager.getAuth();
  
  // Set up default headers
  options.headers = {
    'Content-Type': 'application/json',
    ...options.headers
  };
  
  // Add Authorization header if a token is available
  if (auth.token) {
    options.headers['Authorization'] = `Bearer ${auth.token}`;
  }
  
  try {
    let response = await fetch(url, options);
    
    // If the request fails with 401 (Unauthorized), try to refresh the token
    if (response.status === 401 && auth.refreshToken) {
      try {
        console.log('Access token expired, refreshing...');
        const newToken = await AuthManager.refreshAuthToken();
        options.headers['Authorization'] = `Bearer ${newToken}`;
        // Retry the original request with the new token
        response = await fetch(url, options);
      } catch (refreshError) {
        // If refresh fails, the user needs to log in again
        console.error('Token refresh failed:', refreshError);
        showSessionExpiredModal();
        throw refreshError;
      }
    }
    
    return response;
  } catch (error) {
    console.error('API request error:', error);
    throw error;
  }
}

// =============================================================================
// UI HELPERS (TOAST NOTIFICATIONS, MODALS)
// =============================================================================

function showToast(title, message, type = 'info') {
  const toast = document.getElementById('toast');
  const toastTitle = document.getElementById('toastTitle');
  const toastMessage = document.getElementById('toastMessage');
  const toastIcon = toast.querySelector('i');
  
  toastTitle.textContent = title;
  toastMessage.textContent = message;
  
  // Set toast type and icon
  toast.className = 'toast toast-' + type;
  if (type === 'success') toastIcon.className = 'fas fa-check-circle';
  else if (type === 'error') toastIcon.className = 'fas fa-exclamation-circle';
  else if (type === 'warning') toastIcon.className = 'fas fa-exclamation-triangle';
  else toastIcon.className = 'fas fa-info-circle';
  
  toast.classList.add('show');
  
  // Auto-hide after 5 seconds
  setTimeout(() => toast.classList.remove('show'), 5000);
}

// Close toast when close button is clicked
document.getElementById('toastClose').addEventListener('click', () => {
  document.getElementById('toast').classList.remove('show');
});

function showSessionExpiredModal() {
  document.getElementById('sessionModal').style.display = 'flex';
}

// =============================================================================
// APPLICATION INITIALIZATION AND LIFECYCLE
// =============================================================================

document.addEventListener('DOMContentLoaded', function() {
  // Check if user is already authenticated and show the appropriate view
  if (AuthManager.isAuthenticated()) {
    showDashboard();
  } else {
    showLogin();
  }
});

function showLogin() {
  document.getElementById('loginPage').style.display = 'flex';
  document.getElementById('dashboardPage').style.display = 'none';
  
  const loginForm = document.getElementById('loginForm');
  const loginBtn = document.getElementById('loginBtn');
  const loginBtnText = document.getElementById('loginBtnText');
  const loginSpinner = document.getElementById('loginSpinner');
  const errorMessage = document.getElementById('errorMessage');
  const successMessage = document.getElementById('successMessage');
  const passwordInput = document.getElementById('password');
  const passwordStrength = document.getElementById('passwordStrength');
  
  // Client-side password strength indicator (visual only)
  passwordInput.addEventListener('input', function() {
    const password = this.value;
    let strength = 0;
    if (password.length >= 8) strength++;
    if (password.match(/[a-z]+/)) strength++;
    if (password.match(/[A-Z]+/)) strength++;
    if (password.match(/[0-9]+/)) strength++;
    if (password.match(/[$@#&!]+/)) strength++;
    
    passwordStrength.className = 'password-strength-bar';
    if (strength <= 2) passwordStrength.classList.add('strength-weak');
    else if (strength === 3 || strength === 4) passwordStrength.classList.add('strength-medium');
    else passwordStrength.classList.add('strength-strong');
  });
  
  // Handle login form submission
  loginForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const remember = document.getElementById('remember').checked;
    
    // Show loading state
    loginBtn.disabled = true;
    loginBtnText.textContent = 'Signing In...';
    loginSpinner.style.display = 'inline-block';
    errorMessage.style.display = 'none';
    successMessage.style.display = 'none';
    
    try {
      // Send login request to the backend's /api/login endpoint
      const response = await apiRequest(`${CONFIG.baseUrl}/api/login`, {
        method: 'POST',
        body: JSON.stringify({ username, password, remember })
      });
      
      const data = await response.json();
      
      if (data.success) {
        // Store tokens and user data on successful login
        AuthManager.setAuth(data.token, data.refreshToken, data.user, remember);
        
        successMessage.textContent = 'Login successful! Redirecting to dashboard...';
        successMessage.style.display = 'block';
        
        setTimeout(() => showDashboard(), 1000);
      } else {
        errorMessage.textContent = data.message || 'Invalid username or password';
        errorMessage.style.display = 'block';
      }
    } catch (error) {
      console.error('Login error:', error);
      errorMessage.textContent = 'An error occurred. Please try again.';
      errorMessage.style.display = 'block';
    } finally {
      // Reset button state
      loginBtn.disabled = false;
      loginBtnText.textContent = 'Sign In';
      loginSpinner.style.display = 'none';
    }
  });
  
  // Handle forgot password link (simple helper for demo purposes)
  document.querySelector('.forgot-password').addEventListener('click', function(e) {
    e.preventDefault();
    errorMessage.textContent = 'Default credentials: admin / admin123';
    errorMessage.style.display = 'block';
  });
}

function showDashboard() {
  document.getElementById('loginPage').style.display = 'none';
  document.getElementById('dashboardPage').style.display = 'flex';
  
  const auth = AuthManager.getAuth();
  if (auth.user) {
    document.getElementById('userName').textContent = auth.user.username || 'User';
    document.getElementById('userAvatar').textContent = (auth.user.username || 'U').charAt(0).toUpperCase();
  }
  
  // Set up user dropdown menu
  const userInfo = document.getElementById('userInfo');
  const userDropdown = document.getElementById('userDropdown');
  userInfo.addEventListener('click', () => userDropdown.classList.toggle('show'));
  document.addEventListener('click', (e) => { if (!userInfo.contains(e.target)) userDropdown.classList.remove('show'); });
  
  // Set up logout button
  document.getElementById('logoutBtn').addEventListener('click', async (e) => {
    e.preventDefault();
    await logout();
  });
  
  // Initialize dashboard components
  initializeDashboard();
}

async function logout() {
  try {
    // Call the backend's /api/logout endpoint to invalidate the refresh token
    await apiRequest(`${CONFIG.baseUrl}/api/logout`, { method: 'POST' });
  } catch (error) {
    console.error('Logout API call failed:', error);
  } finally {
    // Always clear local data and redirect to login
    AuthManager.clearAuth();
    showLogin();
    showToast('Logged Out', 'You have been successfully logged out', 'info');
  }
}

function redirectToLogin() {
  logout();
}

// =============================================================================
// DASHBOARD FUNCTIONALITY
// =============================================================================

function initializeDashboard() {
  // --- TAB SYSTEM ---
  const tabs = document.querySelectorAll('.nav-item');
  const tabContents = document.querySelectorAll('.tab-content');
  function activateTab(name) {
    tabs.forEach(t => t.classList.remove('active'));
    tabContents.forEach(c => c.classList.remove('active'));
    const tab = document.querySelector(`.nav-item[data-tab="${name}"]`);
    const content = document.getElementById(name);
    if (tab && content) { tab.classList.add('active'); content.classList.add('active'); }
    
    // Load plugins when the plugins tab is activated
    if (name === 'pluginsTab') {
      fetchPlugins();
    }
  }
  tabs.forEach(tab => tab.addEventListener('click', () => activateTab(tab.dataset.tab)));

  // --- CLOCK ---
  function updateTime() {
    const now = new Date();
    document.getElementById('currentTime').textContent = now.toLocaleTimeString();
  }
  updateTime();
  setInterval(updateTime, 1000);

  // --- CHARTS ---
const maxDataPoints = 20;
const cpuData = [], memoryData = [], chartLabels = [];
const cpuChart = new Chart(document.getElementById('cpuChart').getContext('2d'), {
  type: 'line',
  data: {
    labels: chartLabels,
    datasets: [{
      label: 'CPU Usage (%)',
      data: cpuData,
      borderColor: '#6366f1',
      backgroundColor: 'rgba(99, 102, 241, 0.1)',
      tension: 0.4,
      fill: true
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: {
        beginAtZero: true,
        max: 100,
        grid: { color: 'rgba(255, 255, 255, 0.1)' },
        ticks: { color: '#94a3b8' }
      },
      x: {
        grid: { color: 'rgba(255, 255, 255, 0.1)' },
        ticks: { color: '#94a3b8' }
      }
    },
    plugins: {
      legend: { display: false }
    }
  }
});

const memoryChart = new Chart(document.getElementById('memoryChart').getContext('2d'), {
  type: 'line',
  data: {
    labels: chartLabels,
    datasets: [{
      label: 'Memory Usage (MB)',
      data: memoryData,
      borderColor: '#10b981',
      backgroundColor: 'rgba(16, 185, 129, 0.1)',
      tension: 0.4,
      fill: true
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: {
        beginAtZero: true,
        grid: { color: 'rgba(255, 255, 255, 0.1)' },
        ticks: { color: '#94a3b8' }
      },
      x: {
        grid: { color: 'rgba(255, 255, 255, 0.1)' },
        ticks: { color: '#94a3b8' }
      }
    },
    plugins: {
      legend: { display: false }
    }
  }
});
  // --- DATA FETCHING FUNCTIONS ---
  async function fetchStats() {
    try {
      const data = await apiRequest(`${CONFIG.baseUrl}/stats`).then(r => r.json());
      document.getElementById("uptime").textContent = data.uptime || "N/A";
      document.getElementById("onlineUsers").textContent = data.users || "0";
      document.getElementById("maxConnections").textContent = data.maxConnections || "0";
    } catch (error) { console.error('Error fetching stats:', error); }
  }

  async function fetchSystem() {
    try {
      const data = await apiRequest(`${CONFIG.baseUrl}/system`).then(r => r.json());
      const cpuUsage = (data.cpuUsage || 0).toFixed(2);
      const memoryUsage = (data.memoryMB || 0).toFixed(2);
      document.getElementById("cpuUsage").textContent = cpuUsage + "%";
      document.getElementById("memoryUsage").textContent = memoryUsage + " MB";
      document.getElementById("diskUsage").textContent = `${(data.diskUsedGB || 0).toFixed(2)} / ${(data.diskTotalGB || 0).toFixed(2)} GB`;
      document.getElementById("networkUsageD").textContent = `${(data.netReceivedMB || 0).toFixed(2)} MB ↓`;
      document.getElementById("networkUsageU").textContent = `${(data.netSentMB || 0).toFixed(2)} MB ↑`;
      updateCharts(parseFloat(cpuUsage), parseFloat(memoryUsage));
    } catch (error) { console.error('Error fetching system data:', error); }
  }

  async function fetchLogs() {
    try {
      const logs = await apiRequest(`${CONFIG.baseUrl}/logs`).then(r => r.json());
      const logsEl = document.getElementById("serverLogs");
      logsEl.innerHTML = logs.map(l => {
        let className = 'log-info';
        if (l.includes('[ERROR]')) className = 'log-error';
        else if (l.includes('[WARNING]')) className = 'log-warning';
        else if (l.includes('[SECURITY]')) className = 'log-security';
        return `<div class="${className}">${l}</div>`;
      }).join("");
    } catch (error) { console.error('Error fetching logs:', error); }
  }

  async function fetchVideos() {
    try {
      const videos = await apiRequest(`${CONFIG.baseUrl}/videos`).then(r => r.json());
      const videoList = document.getElementById("videoList");
      if (!videos || videos.length === 0) {
        videoList.innerHTML = "<p style='color: var(--text-dim); text-align: center; grid-column: 1/-1; padding: 20px;'>No videos uploaded yet.</p>";
        return;
      }
      videoList.innerHTML = "";
      videos.forEach(v => {
        const div = document.createElement("div"); div.className = "video-card";
        const thumbnail = document.createElement("div"); thumbnail.className = "video-thumbnail";
        thumbnail.style.backgroundImage = `url('https://picsum.photos/seed/${v}/300/200.jpg')`;
        const title = document.createElement("p"); title.textContent = v;
        div.appendChild(thumbnail); div.appendChild(title);
        div.onclick = () => playVideo(v);
        videoList.appendChild(div);
      });
    } catch (error) {
      console.error('Error fetching videos:', error);
      const videoList = document.getElementById("videoList");
      videoList.innerHTML = `<p style='color: var(--danger); text-align: center; grid-column: 1/-1; padding: 20px;'><i class='fas fa-exclamation-circle'></i> Error loading videos.</p>`;
    }
  }

  // --- VIDEO PLAYBACK ---
  async function playVideo(fileName) {
    const videoPlayer = document.getElementById("videoPlayer");
    const loadingMsg = document.getElementById("loadingMsg");
    const videoError = document.getElementById("videoError");
    const videoErrorText = document.getElementById("videoErrorText");
    
    videoPlayer.style.display = "none"; videoError.style.display = "none";
    loadingMsg.style.display = "block";
    
    const videoUrl = `${CONFIG.baseUrl}/videos/${fileName}`;
    
    try {
      // IMPORTANT: Fetch the video through our authenticated API to include the Bearer token
      const response = await apiRequest(videoUrl);
      const blob = await response.blob();
      const blobUrl = URL.createObjectURL(blob);
      
      videoPlayer.src = blobUrl;
      videoPlayer.oncanplay = () => { videoPlayer.style.display = "block"; loadingMsg.style.display = "none"; };
      videoPlayer.onerror = (e) => { loadingMsg.style.display = "none"; videoError.style.display = "block"; videoErrorText.textContent = "Error loading video."; };
      videoPlayer.onstalled = () => { loadingMsg.innerHTML = '<div class="loading"></div><p style="color: var(--warning);">Stalled, retrying...</p>'; videoPlayer.load(); };
      videoPlayer.onunload = () => URL.revokeObjectURL(blobUrl); // Clean up memory
      videoPlayer.load();
    } catch (err) {
      console.error('Error loading video:', err);
      loadingMsg.style.display = "none"; videoError.style.display = "block";
      videoErrorText.textContent = "Error loading video: " + err.message;
    }
  }

  // --- VIDEO UPLOAD ---
  window.uploadVideoFromUrl = async function() {
    const urlInput = document.getElementById("videoUrlInput");
    const status = document.getElementById("urlUploadStatus");
    const progressBar = document.getElementById("uploadProgress");
    const uploadProgressBar = document.getElementById("uploadProgressBar");
    const url = urlInput.value.trim();
    
    if (!url) { status.innerHTML = "<i class='fas fa-exclamation-circle'></i> Please enter a URL"; return; }
    
    status.innerHTML = "<i class='fas fa-spinner fa-spin'></i> Downloading...";
    progressBar.style.display = "block";
    
    try {
      const response = await apiRequest(`${CONFIG.baseUrl}/upload-url`, { method: "POST", body: JSON.stringify({ url }) });
      const data = await response.json();
      
      if (data.success) {
        status.innerHTML = `<i class='fas fa-check-circle' style='color: var(--success);'></i> ${data.message}`;
        urlInput.value = ''; progressBar.style.display = "none";
        showToast('Upload Successful', data.message, 'success');
        setTimeout(fetchVideos, 1000); // Refresh video list
      } else {
        status.innerHTML = `<i class='fas fa-exclamation-circle' style='color: var(--danger);'></i> ${data.message}`;
        progressBar.style.display = "none";
        showToast('Upload Failed', data.message, 'error');
      }
    } catch (err) {
      console.error('Upload error:', err);
      status.innerHTML = `<i class='fas fa-exclamation-circle' style='color: var(--danger);'></i> Error: ${err.message}`;
      progressBar.style.display = "none";
      showToast('Upload Failed', err.message, 'error');
    }
  };

  // --- PLUGIN FUNCTIONS ---
  async function fetchPlugins() {
    try {
      const response = await apiRequest(`${CONFIG.baseUrl}/api/plugins`);
      const data = await response.json();
      
      const pluginsList = document.getElementById('pluginsList');
      
      if (!data.success || !data.plugins || data.plugins.length === 0) {
        pluginsList.innerHTML = `
          <div class="empty-plugins">
            <i class="fas fa-plug"></i>
            <h3>No plugins installed</h3>
            <p>Upload a plugin file to get started</p>
          </div>
        `;
        return;
      }
      
      pluginsList.innerHTML = '';
      data.plugins.forEach(plugin => {
        const pluginCard = document.createElement('div');
        pluginCard.className = 'plugin-card';
        pluginCard.innerHTML = `
          <div class="plugin-header">
            <div class="plugin-title">
              <i class="fas fa-cube"></i>
              <span>${plugin.name}</span>
            </div>
            <div class="plugin-status ${plugin.enabled ? 'active' : 'inactive'}">
              ${plugin.enabled ? 'Active' : 'Inactive'}
            </div>
          </div>
          <div class="plugin-description">
            Plugin version ${plugin.version}
          </div>
          <div class="plugin-actions">
          </div>
          <div class="plugin-content" id="plugin-${plugin.id}-content">
            <div class="plugin-form">
              <div class="plugin-form-group">
                <label>Version</label>
                <input type="text" value="${plugin.version || 'Unknown'}" readonly>
              </div>
              <div class="plugin-form-group">
                <label>API Routes</label>
                <div class="plugin-result show">
                  <p>This plugin registers API routes with the server</p>
                </div>
              </div>
            </div>
          </div>
        `;
        pluginsList.appendChild(pluginCard);
      });
    } catch (error) {
      console.error('Error fetching plugins:', error);
      const pluginsList = document.getElementById('pluginsList');
      pluginsList.innerHTML = `
        <div class="plugin-result error show">
          <i class="fas fa-exclamation-circle"></i> Error loading plugins: ${error.message}
        </div>
      `;
    }
  }

  window.togglePlugin = async function(pluginId, enable) {
    try {
      const response = await apiRequest(`${CONFIG.baseUrl}/api/plugins/${pluginId}/${enable ? 'enable' : 'disable'}`, {
        method: 'POST'
      });
      
      if (response.ok) {
        showToast('Plugin Updated', `Plugin ${enable ? 'enabled' : 'disabled'} successfully`, 'success');
        fetchPlugins(); // Refresh the plugins list
      } else {
        const error = await response.json();
        showToast('Plugin Update Failed', error.message || 'Unknown error', 'error');
      }
    } catch (error) {
      console.error('Error toggling plugin:', error);
      showToast('Plugin Update Failed', error.message, 'error');
    }
  };

  window.configurePlugin = function(pluginId) {
    const content = document.getElementById(`plugin-${pluginId}-content`);
    content.classList.toggle('show');
  };

  // Handle plugin file upload
  const pluginFileInput = document.getElementById('pluginFileInput');
  const pluginUploadStatus = document.getElementById('pluginUploadStatus');
  
  pluginFileInput.addEventListener('change', async function(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    // Check file extension
    const fileName = file.name.toLowerCase();
    if (!fileName.endsWith('.dll') && !fileName.endsWith('.zip')) {
      pluginUploadStatus.innerHTML = `<div class="plugin-result error show"><i class="fas fa-exclamation-circle"></i> Invalid file format. Please upload a .dll or .zip file.</div>`;
      return;
    }
    
    // Create form data
    const formData = new FormData();
    formData.append('plugin', file);
    
    // Show loading state
    pluginUploadStatus.innerHTML = `<div class="plugin-result show"><i class="fas fa-spinner fa-spin"></i> Uploading plugin...</div>`;
    
    try {
      const response = await fetch(`${CONFIG.baseUrl}/api/plugins/upload`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${AuthManager.getAuth().token}`
        },
        body: formData
      });
      
      const result = await response.json();
      
      if (response.ok && result.success) {
        pluginUploadStatus.innerHTML = `<div class="plugin-result success show"><i class="fas fa-check-circle"></i> Plugin uploaded successfully!</div>`;
        showToast('Plugin Uploaded', result.message || 'Plugin has been uploaded successfully', 'success');
        
        // Reset file input
        pluginFileInput.value = '';
        
        // Refresh plugins list
        fetchPlugins();
      } else {
        pluginUploadStatus.innerHTML = `<div class="plugin-result error show"><i class="fas fa-exclamation-circle"></i> ${result.message || 'Failed to upload plugin'}</div>`;
        showToast('Upload Failed', result.message || 'Failed to upload plugin', 'error');
      }
    } catch (error) {
      console.error('Error uploading plugin:', error);
      pluginUploadStatus.innerHTML = `<div class="plugin-result error show"><i class="fas fa-exclamation-circle"></i> Error: ${error.message}</div>`;
      showToast('Upload Failed', error.message, 'error');
    }
  });

  // --- INITIAL FETCH AND REFRESH INTERVALS ---
  fetchStats(); fetchSystem(); fetchLogs(); fetchVideos();
  
  // Refresh stats/system/logs every 5 seconds (less aggressive on the server)
  setInterval(() => { fetchStats(); fetchSystem(); fetchLogs(); }, 1000);
  
  // Refresh video list every 10 seconds
  setInterval(fetchVideos, 5000);
}
</script>
</body>
</html>
